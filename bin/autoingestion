#!/usr/bin/env ruby

$:.unshift File.expand_path('../../lib', __FILE__)

require 'itunesconnect'
require 'yaml'

client = ITunesConnect::Client.new
yesterday = (Time.new - 24*60*60).strftime("%Y%m%d")

if File.exists?("config.yml")
  config = YAML::load(File.open("config.yml"))
  client.username = config['username']
  client.password = config['password']
  client.vendor_number = config['vendor_number']
else
  print "iTunes Connect username/email address:    "
  client.username = gets.strip!
  print "iTunes Connect password:                  "
  begin  # Don't show the user's password in the console
    system("stty -echo")
    client.password = gets.strip!
  ensure
    system("stty echo")
  end
  print "\nVendor number:                            "
  client.vendor_number = gets.strip!
  print "Type of report:                [Sales]    "
  client.type_of_report = gets.strip!
  print "Date type:                     [Daily]    "
  client.date_type = gets.strip!
  print "Report type:                   [Summary]  "
  client.report_type = gets.strip!
  print "Report date:                   [#{yesterday}] "
  client.report_date = gets.strip!
end

client.type_of_report = "Sales"   if client.type_of_report.nil?
client.date_type      = "Daily"   if client.date_type.nil?
client.report_type    = "Summary" if client.report_type.nil?
client.report_date    = yesterday if client.report_date.nil?
client.perform_request
